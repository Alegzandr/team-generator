services:
    server:
        image: node:20
        working_dir: /app
        env_file:
            - server/.env
        command: sh -c "npm install && npm run dev"
        volumes:
            - ./server:/app
            - server_node_modules:/app/node_modules
            - server_data:/app/data
        ports:
            - "3000:3000"
        environment:
            - CLIENT_URL=http://localhost:5173
            - DATABASE_URL=/app/data/database.sqlite

    client:
        image: node:20
        working_dir: /app
        env_file:
            - client/.env
        command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 5173"
        volumes:
            - ./client:/app
            - client_node_modules:/app/node_modules
        ports:
            - "5173:5173"
        environment:
            - VITE_API_URL=http://localhost:3000
        depends_on:
            - server

volumes:
    server_node_modules:
    client_node_modules:
    server_data:
